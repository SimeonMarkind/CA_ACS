---
title: "California Overview"
author: "Simeon Markind"
date: '`r format(Sys.time(), "%b %d, %Y")`'
output: html_document
---
Documentation can be found at [here]("http://www2.census.gov/programs-surveys/acs/tech_docs/pums/ACS2010_2014_PUMS_README.pdf") as well as [here]("http://www2.census.gov/programs-surveys/acs/tech_docs/pums/data_dict/PUMS_Data_Dictionary_2010-2014.pdf"). 

Information on the accuracy of the data can be found [here]("http://www2.census.gov/programs-surveys/acs/tech_docs/pums/accuracy/2010_2014AccuracyPUMS.pdf")

Data downloaded from: [ACS PUMS page]("https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_pums_csv_2010_2014&prodType=document")

```{r setup}
knitr::opts_chunk$set(echo=FALSE, include = TRUE, warning = FALSE,
                      fig.align = "center")
library(data.table)
library(ggplot2)
library(knitr)
library(scales)
library(plotly)
#filter.data <- fread("C:/Users/Owner/Documents/R/PUMS/filterData.csv")

```

```{r theme setup}
theme.simeon <- theme_gray() +
    theme(axis.title = element_text(family = "serif",
                                    size = 14,
                                    color = "blue4"),
          plot.background = element_rect(fill = "cornsilk",
                                         color = "black"),
          plot.title = element_text(family = "serif",
                                    face = "bold",
                                    size = 16,
                                    color = "blue4",
                                    hjust = 0.5),
          plot.subtitle = element_text(family = "serif",
                                    face = "bold",
                                    size = 10,
                                    color = "blue4",
                                    hjust = 0.5),
          plot.caption = element_text(family = "serif",
                                    face = "bold",
                                    size = 10,
                                    color = "blue4"),
          legend.background = element_rect(fill = "cornsilk",
                                           color = "blue4"),
          legend.title.align = 0.5,
          legend.title = element_text(family = "serif",
                                      size = 12,
                                      color = "blue4",
                                      face = "italic"),
          panel.background = element_rect(fill = "grey90",
                                          color = "blue4"))

theme_set(theme.simeon)
                                    
```

# Introduction

Every year the census burea releases 5 year aggregates public use microdata series, (PUMS), of American Community Survey, (ACS), data. Using the California state level file we'll examine trends in income inequality over the five year period 2010-2014. 

```{r Gender Mean data}
## Will want to use character values to make gender more easily explicit
filter.data[, sex := ifelse(SEX == 1, "Male", "Female")]

plot.data <- filter.data[, .(mInc = weighted.mean(PINCP, PWGTP, 
                                                  na.rm = T), 
                             mWage = weighted.mean(WAGP, PWGTP,
                                                   na.rm = T)),                 .(year, sex)]

```

```{r gender mean plot}
ymax <- max(plot.data[,.(mInc, mWage)])

genderMean.plot <- ggplot(plot.data, 
                          aes(x = year,
                              color = sex,
                              group = sex)) +
    geom_line(aes(y = mInc, linetype = "mInc"), size = 1.3) +
    geom_line(aes(y = mWage, linetype = "mWage"), size = 1.3) +
    scale_linetype_discrete(name = "Measure", 
                            labels = c("Income", "Wages")) +
    scale_color_discrete(name = "Gender") +
    ggtitle(label = "2010-2014 Income and Wages in CA") +
    labs(caption = "Simeon Markind") +
    scale_y_continuous(name = "2014 USD", limits = c(0, 1.1*ymax),
                       breaks = pretty(c(0,1.1*ymax),5),
                       labels = dollar) +
    scale_x_discrete(name = "Year")
                                    

genderMean.plot
```

```{r Race Mean data}
raceMean.data <- filter.data[, .(mInc = weighted.mean(PINCP, PWGTP, 
                                                  na.rm = T), 
                             mWage = weighted.mean(WAGP, PWGTP,
                                                   na.rm = T)),                 .(year, race)]

```

```{r Race Mean plot}
ymax <- max(raceMean.data[, .(mInc, mWage)])

raceMean.plot <- ggplot(raceMean.data, 
                          aes(x = year,
                              color = race,
                              group = race)) +
    geom_line(aes(y = mInc, linetype = "mInc"), size = 1.3) +
    geom_line(aes(y = mWage, linetype = "mWage"), size = 1.3) +
    scale_linetype_discrete(name = "Measure", 
                            labels = c("Income", "Wages")) +
    scale_color_discrete(name = "Race") +
    ggtitle(label = "2010-2014 Income and Wages in CA") +
    labs(caption = "Simeon Markind") +
    scale_y_continuous(name = "2014 USD",
                       breaks = pretty(c(0, 1.1*ymax), 5),
                       limits = c(0, 1.1*ymax),
                       labels = dollar) +
    scale_x_discrete(name = "Year")
                                    

raceMean.plot
```

```{r Educ Mean Data}
educMean.data <- filter.data[!is.na(eduStat), 
                             .(mInc = weighted.mean(PINCP, PWGTP, 
                                                  na.rm = T), 
                             mWage = weighted.mean(WAGP, PWGTP,
                                                   na.rm = T)),                 .(year, eduStat)]

educMean.data <- melt(educMean.data, id.vars = c("year", "eduStat"))

educMean.data[, year := as.Date(paste0(year,"-01-01"), 
                                format = "%Y-%m-%d")]
```

```{r Educ Mean Plot}

ymax <- max(educMean.data$value)

educMean.plot <- ggplot(data = educMean.data, 
                        aes(x = year, y = value, color = eduStat,
                            linetype = variable)) +
    geom_line(size = 1.3) +
    ggtitle(label = "2010-2014 Income and Wages in California",
            subtitle = "Education Average") +
    scale_y_continuous(name = "2014 USD", limits = c(0, 1.1*ymax),
                       labels = dollar) +
    scale_x_date(name = "Year") +
    labs(caption = "Simeon Markind") +
    scale_linetype_discrete(name = "Measure",
                            labels = c("Income", "Wages")) +
    scale_color_discrete(name = "Education\n Attainment")

educMean.plot
```

```{r Count for each Occ bin}
## See which are the most popular job fields by the recoded Occ bins
OccBin.data <- filter.data[empStat != "Unemployed",
                           .(Occ, year, PWGTP)]

OccBin.data <- OccBin.data[, .(count = sum(PWGTP)),
                           by = .(Occ, year)][order(year, -count)]

## top six jobs per year
top6 <- dcast(OccBin.data[, head(.SD, 6), by = .(year)],
              year ~ ..., value.var = "count")

bottom6 <- dcast(OccBin.data[, tail(.SD, 6), by = .(year)],
                 year ~ Occ, value.var = "count")

top6
bottom6


```

